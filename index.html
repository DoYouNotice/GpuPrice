<!DOCTYPE html>
<html>
<head>
    <title>Graphics Card Data</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            var loadingAnimation = $('<div>').addClass('loading-animation');

            function showLoadingAnimation() {
                $('#results').empty().append(loadingAnimation);
            }

            function hideLoadingAnimation() {
                loadingAnimation.remove();
            }

            $.ajax({
                url: "https://api.allorigins.win/raw?url=https://www.tomshardware.com/reviews/gpu-hierarchy,4388.html",
                dataType: "html",
                beforeSend: showLoadingAnimation,
                success: function(response) {
                    var html = $.parseHTML(response);

                    var tableRows = $(html).find('#slice-container-L8SfcAV5o28ayEFjzq6cfX-table-10 > div:nth-child(2) > table:nth-child(1) > tbody:nth-child(3) > tr');

                    var fpsData = {};
                    tableRows.each(function() {
                        var name = $(this).find('td:nth-child(1) > strong:nth-child(1) > a:nth-child(1)').text().trim();
                        var fpsPercentage = $(this).find('td:nth-child(2)').text().trim();
                        var fpsMatch = fpsPercentage.match(/([\d.]+)fps/);
                        var fps = fpsMatch ? parseFloat(fpsMatch[1]) : null;

                        fpsData[name] = fps;
                    });

                    var graphicsCards = {
                        "GeForce RTX 3060 Ti": "03+05+16+-+RTX+3060+Ti",
                        "GeForce RTX 4090": "03+05+17+-+RTX+4090",
                        "Radeon RX 7900 XTX": "02+04+14+-+RX+7900",
                        // Add more graphics cards here
                    };

                    var basePriceUrl = "https://geizhals.de/?cat=gra16_512&xf=9816_";
                    var cheapestPrices = {};
                    var costPerFrame = {};

                    var cardList = Object.keys(graphicsCards);
                    var currentIndex = 0;

                    function fetchPrice(card, cardUrl) {
                        var url = basePriceUrl + cardUrl;

                        $.ajax({
                            url: "https://api.allorigins.win/raw?url=" + encodeURIComponent(url),
                            headers: {
                                "Origin": "https://mindfactory.de"
                            },
                            dataType: "html",
                            success: function(response) {
                                var priceText = $(response).find("#product0 > div:nth-child(8) > span:nth-child(1) > span:nth-child(1)").text().trim();
                                var price = priceText.replace(/[^\d.,]/g, "").replace(".", "").replace(",", ".");
                                price = price ? parseFloat(price) : null;

                                cheapestPrices[card] = price;
                                displayData();

                                currentIndex++;
                                if (currentIndex < cardList.length) {
                                    setTimeout(function() {
                                        fetchPrice(cardList[currentIndex], graphicsCards[cardList[currentIndex]]);
                                    }, 1000); // 1 second delay
                                } else {
                                    hideLoadingAnimation();
                                }
                            },
                            error: function() {
                                cheapestPrices[card] = null;
                                displayData();

                                currentIndex++;
                                if (currentIndex < cardList.length) {
                                    setTimeout(function() {
                                        fetchPrice(cardList[currentIndex], graphicsCards[cardList[currentIndex]]);
                                    }, 1000); // 1 second delay
                                } else {
                                    hideLoadingAnimation();
                                }
                            }
                        });
                    }

                    function displayData() {
                        var sortedCards = Object.entries(costPerFrame).sort(function(a, b) {
                            return a[1] - b[1];
                        });

                        $("#results").empty();

                        sortedCards.forEach(function(card) {
                            var cardName = card[0];
                            var price = cheapestPrices[cardName];
                            var cost = card[1];
                            var fps = fpsData[cardName] || "N/A";

                            var result = $("<div>").addClass("result");
                            result.append($("<h3>").text(cardName));
                            result.append($("<p>").text("Cheapest price: " + (price ? price.toFixed(2) + " €" : "N/A")));
                            result.append($("<p>").text("Cost per frame: " + (cost ? cost.toFixed(2) + " € per frame" : "N/A")));
                            result.append($("<p>").text("FPS: " + fps + " (Ultra 1080p)"));

                            $("#results").append(result);
                        });
                    }

                    fetchPrice(cardList[currentIndex], graphicsCards[cardList[currentIndex]]);
                },
                error: function() {
                    hideLoadingAnimation();
                    $("#results").text("No data available");
                }
            });
        });
    </script>
    <style>
        .result {
            margin-bottom: 20px;
            border: 1px solid #ccc;
            padding: 10px;
        }
        .loading-animation {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100px;
        }
        .loading-animation:before {
            content: "";
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 5px solid #ccc;
            border-top-color: #000;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>
<body>
    <h1>Graphics Card Data</h1>
    <div id="results"></div>
</body>
</html>
